I"Çs<p>å¦‚æ„¿äº²æ‰‹å‡ºäº†ä¸€åœºå®Œæ•´æ¯”èµ›ï¼Œç¥å¤§å®¶Aé¢˜å¼€å¿ƒ~<a href="https://github.com/wu-kan/SYSU-Novice-Programming-Contest-2019--Online">é¢˜ç›®æ•°æ®&amp;ç°åœºæ¦œå•</a></p>

<h2 id="franchouchou">FranChouChou</h2>

<p>FranChouChou is an idol group founded by KÅtarÅ Tatsumi and led by Saki NikaidÅ, consisting of zombies of legendary girls resurrected by Kotaro. Their objective is to save Saga and resurrect the local idol trend in the process.</p>

<p><img src="https://cdn.jsdelivr.net/gh/wu-kan/MizunoAi/EP12/EP12(44).jpg" alt="p44" /></p>

<p>The idol groupâ€™s tentative name was Death Musume, which was later changed to Green Face by Kotaro. The idol members of the group, however, found the names not satisfactory, eventually deciding to rename it to Franchouchou based on the sound Tae made when she sneezed.</p>

<p><img src="https://cdn.jsdelivr.net/gh/wu-kan/MizunoAi/EP12/EP12(43).jpg" alt="p43" /></p>

<p>The followings are members in the group:</p>

<ul>
  <li>Zombie #0 Yamada Tae</li>
  <li>Zombie #1 Minamoto Sakura</li>
  <li>Zombie #2 Nikaido Saki</li>
  <li>Zombie #3 Mizuno Ai</li>
  <li>Zombie #4 Konno Junko</li>
  <li>Zombie #5 Yugiri</li>
  <li>Zombie #6 Hoshikawa Lily</li>
</ul>

<p>Now with given a name of an idol, you are asked about her/his number.</p>

<h3 id="input">Input</h3>

<p>The input contains only single line, one of the names mentioned above.</p>

<h3 id="output">Output</h3>

<p>You should output the number of the zombie.</p>

<h3 id="sample-input">Sample Input</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Mizuno Ai
</code></pre></div></div>

<h3 id="sample-output">Sample Output</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>3
</code></pre></div></div>

<h3 id="solution">Solution</h3>

<p>ç”¨äºç­¾åˆ°çš„å­—ç¬¦ä¸²æ¯”è¾ƒé¢˜ï¼Œè®¤çœŸè¯»é¢˜çš„åŒå­¦åº”è¯¥éƒ½ä¸ä¼šå†™é”™~</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;bits/stdc++.h&gt;
</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
	<span class="n">string</span> <span class="n">s</span><span class="p">;</span>
	<span class="n">getline</span><span class="p">(</span><span class="n">cin</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span>
	<span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">map</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span><span class="p">{{</span><span class="s">"Yamada Tae"</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
							 <span class="p">{</span><span class="s">"Minamoto Sakura"</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span>
							 <span class="p">{</span><span class="s">"Nikaido Saki"</span><span class="p">,</span> <span class="mi">2</span><span class="p">},</span>
							 <span class="p">{</span><span class="s">"Mizuno Ai"</span><span class="p">,</span> <span class="mi">3</span><span class="p">},</span>
							 <span class="p">{</span><span class="s">"Konno Junko"</span><span class="p">,</span> <span class="mi">4</span><span class="p">},</span>
							 <span class="p">{</span><span class="s">"Yugiri"</span><span class="p">,</span> <span class="mi">5</span><span class="p">},</span>
							 <span class="p">{</span><span class="s">"Hoshikawa Lily"</span><span class="p">,</span> <span class="mi">6</span><span class="p">}}</span>
				<span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p><del>æˆ‘æ°¸è¿œå–œæ¬¢æ°´é‡çˆ±</del></p>

<h2 id="number">Number</h2>

<p>Reeeeein is good at math problems, because he always holds $n-1$ integers in his brain, and every element exactly appears $k$ times. However, when he once took part in a programming contest, a new integer suddenly squeezed into his brain. This made him so confused that he wrote 5 mistakes within 20 code lines.</p>

<p>Now please help Reeeeein to find this new integer which appears exactly once!</p>

<h3 id="input-1">input</h3>

<p>The first line contains two integers $n,k$.</p>

<p>The second line contains $n$ integers $a_0,a_1,\ldots,a_{n-1}$.</p>

<p>$1&lt;k&lt;n\leq 114514$</p>

<p>$\forall i \in [0,n),a_i \in [0,1919810)$</p>

<h3 id="output-1">output</h3>

<p>You should output the number.</p>

<h3 id="sample-input-1">Sample Input</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>5 2
2 2 3 29 3
</code></pre></div></div>

<h3 id="sample-output-1">Sample Output</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>29
</code></pre></div></div>

<h3 id="note">Note</h3>

<p>The best algorithm for this problem has a linear time complexity and a constant space complexity. However, solutions with $O(n\log n)$ time complexity will also be accepted!</p>

<h3 id="solution-1">Solution</h3>

<p>ä¸€ä¸ªä½¿ç”¨$O(n\log n)$æ—¶é—´ã€$O(n)$ç©ºé—´çš„è§£æ³•æ˜¯ä¸éš¾æƒ³çš„ï¼Œç›´æ¥æ’åºï¼Œæˆ–æ˜¯ä½¿ç”¨<code class="highlighter-rouge">map&lt;int, int&gt;</code>å³å¯ã€‚</p>

<p>ä¸€ä¸ªä½¿ç”¨$O(\max{n,\mid a_i \mid})$æ—¶é—´å’Œ$O(\mid a_i \mid)$ç©ºé—´çš„è§£æ³•ä¹Ÿæ˜¯ä¸éš¾æƒ³çš„ï¼ŒæŠŠä¸Šä¸€æ­¥çš„<code class="highlighter-rouge">map</code>æ¢æˆä¸€ä¸ª<code class="highlighter-rouge">int</code>æ•°ç»„å³å¯ã€‚</p>

<p>é‚£ä¹ˆæˆ‘ä»¬å¢åŠ ä¸€ç‚¹éš¾åº¦ï¼Œè€ƒè™‘ä½¿ç”¨$O(n)$æ—¶é—´å’Œ$O(1)$ç©ºé—´ï¼ˆæ¯”å¦‚1Må†…å­˜ï¼‰ï¼Œæ€ä¹ˆè§£å†³é—®é¢˜å‘¢ï¼Ÿæ³¨æ„ï¼Œåœ¨è¿™æ ·çš„å†…å­˜é™åˆ¶ä¹‹ä¸‹ï¼Œç”šè‡³ä¸èƒ½æŠŠæ•´ä¸ªæ•°ç»„å­˜ä¸‹æ¥ã€‚</p>

<p>æˆ‘ä»¬å…ˆè€ƒè™‘è¿™ä¸ªé—®é¢˜çš„ä¸€ä¸ªç®€å•ç‰ˆæœ¬ï¼šå½“$k=2$çš„æ—¶å€™ï¼Œç•¥æœ‰ç»éªŒçš„åŒå­¦åº”è¯¥ä¼šçŸ¥é“ï¼Œè¿™æ˜¯ä¸€ä¸ª<a href="https://leetcode.com/problems/single-number/">ç»å…¸é—®é¢˜</a>ï¼Œå¯¹æ•´ä¸ªåºåˆ—æ±‚ä¸€é<a href="https://baike.baidu.com/item/%E5%BC%82%E6%88%96/10993677">å¼‚æˆ–</a>å’Œå³å¯ã€‚</p>

<p>å½“æˆ‘ä»¬å¢åŠ $k$çš„æ—¶å€™ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ$k=3$çš„æ—¶å€™ï¼Œ<a href="https://leetcode.com/problems/single-number-ii/">è¿™ä¸ªé¢˜ç›®</a>ä»ç„¶å¯ä»¥ä½¿ç”¨æ›´åŠ å¤æ‚çš„ä½è¿ç®—ï¼Œâ€œçœ‹èµ·æ¥å¾ˆå·§å¦™â€çš„åšæ‰è¿™ä¸ªé¢˜ã€‚è¯¦ç»†çš„é¢˜æ³•è¿™é‡Œæˆ‘ç•¥æ‰ï¼Œå¯ä»¥å»çœ‹<a href="https://blog.csdn.net/D5__J9/article/details/89842946">è¿™ç¯‡åšå®¢</a>ã€‚ç„¶è€Œæˆ‘è§‰å¾—ï¼Œè¿™äº›è§£æ³•å¹¶æ²¡æœ‰è§¦åŠåˆ°é—®é¢˜çš„æœ¬è´¨ï¼Œäºæ˜¯å°±æœ‰äº†è¿™é“é¢˜ã€‚</p>

<p>å…ˆæ¥è¯´è¿™é¢˜çš„è§£æ³•ï¼Œå…¶å®éå¸¸ç®€å•ï¼š<strong>å¯¹äºŒè¿›åˆ¶çš„æ¯ä¸€ä½åšæ¨¡$k$æ„ä¹‰ä¸‹çš„åŠ æ³•</strong>ï¼Œè¿™æ ·ï¼Œæ°å¥½å‡ºç°$k$æ¬¡çš„è¾“å…¥å°±ä¼šè¢«ç­›æ‰ã€‚</p>

<p>ç°åœ¨æˆ‘ä»¬å†å›å»çœ‹æœ€åˆçš„ç‰ˆæœ¬ï¼Œå½“$k=2$çš„æ—¶å€™ï¼Œå¯¹äºŒè¿›åˆ¶çš„æ¯ä¸€ä½åšæ¨¡2çš„åŠ æ³•å°±ç›¸å½“äºå–å¼‚æˆ–å’Œã€‚ä¸Šè¿‡æ•°å­—ç”µè·¯è®¾è®¡ã€è‡ªå·±å®ç°è¿‡åŠ æ³•å™¨çš„åŒå­¦æ˜¯ä¸æ˜¯æ›´åŠ èƒ½å¤Ÿç†è§£äº†ï¼Œ<strong>å¼‚æˆ–è¿ç®—çš„æœ¬è´¨æ˜¯æ²¡æœ‰è¿›ä½çš„äºŒè¿›åˆ¶åŠ æ³•</strong>å‘¢~</p>

<p>æ€»ä¹‹ï¼Œç”±äºæ˜¯æ–°æ‰‹èµ›ï¼Œå°±æ²¡æœ‰åœ¨é¢˜ç›®é™åˆ¶ä¸Šæå¤§å®¶äº†ï¼Œæˆ‘è¿˜æ˜¯æƒ³å‡ºä¸€ä¸ªå¤§å®¶éƒ½å¯ä»¥åšï¼Œä½†æ˜¯å­˜åœ¨ä¼˜ç§€è§£æ³•çš„é¢˜ç›®~</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;bits/stdc++.h&gt;
</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">BIT</span> <span class="o">=</span> <span class="mi">31</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">[</span><span class="n">BIT</span><span class="p">];</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
	<span class="n">scanf</span><span class="p">(</span><span class="s">"%d%d"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">k</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">scanf</span><span class="p">(</span><span class="s">"%d"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">),</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">a</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">,</span> <span class="n">a</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span>
				<span class="o">++</span><span class="n">b</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">BIT</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
		<span class="n">a</span> <span class="o">|=</span> <span class="n">b</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">%</span> <span class="n">k</span> <span class="o">&lt;&lt;</span> <span class="n">j</span><span class="p">;</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">"%d"</span><span class="p">,</span> <span class="n">a</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p><del>å…³äºæ¼”å‘˜Reeeeeinçš„æ•…äº‹å¯ä»¥çœ‹<a href="https://wu-kan.github.io/posts/acm/%E5%86%8D%E8%A7%81-%E7%AE%97%E6%B3%95%E7%AB%9E%E8%B5%9B">è¿™ç¯‡åšå®¢</a></del></p>

<h2 id="markdown">Markdown</h2>

<p>Ender starts his blog life today! The first thing for him to learn is markdown, which is a system for annotating a document in a way that is syntactically distinguishable from the text. The user can control the display of the document; formatting words as bold or italic, adding images, and creating lists are just a few of the things one can do with markdown, and the markdown renderer will convert the text to html format.</p>

<p>There are many implementations of markdown renderer. But we only consider a (extremely!) simplified subset here.</p>

<ul>
  <li>title: Convert <code class="highlighter-rouge"># TITLE</code> to <code class="highlighter-rouge">&lt;h1&gt;TITLE&lt;/h1&gt;</code>, <code class="highlighter-rouge">## TITLE</code> to <code class="highlighter-rouge">&lt;h2&gt;TITLE&lt;/h2&gt;</code>, $\ldots$, <code class="highlighter-rouge">###### TITLE</code> to <code class="highlighter-rouge">&lt;h6&gt;TITLE&lt;/h6&gt;</code>.</li>
  <li>link: Convert <code class="highlighter-rouge">[TEXT](LINK)</code> to <code class="highlighter-rouge">&lt;a href="LINK"&gt;TEXT&lt;/a&gt;</code> tag.</li>
  <li>newline: Put a <code class="highlighter-rouge">&lt;br/&gt;</code> tag to the end of a line.</li>
</ul>

<p>You can simply assume that:</p>

<ul>
  <li>No extra space at the beginning and end of each line.</li>
  <li>Any character in <code class="highlighter-rouge">&lt;&gt;</code> will not appear in the context.</li>
  <li>There is a whitespace between <code class="highlighter-rouge">#</code> and TITLE.</li>
  <li>There are no links in title.</li>
  <li>The title always occupies a whole line.</li>
  <li><code class="highlighter-rouge">#</code> will not appear in the context unless it represents a title.</li>
  <li>Any character in <code class="highlighter-rouge">[]()</code> will not appear in the context unless it is a link.</li>
  <li><code class="highlighter-rouge">[]()</code> will not be nested.</li>
</ul>

<p>If you still have any questions, you can refer to the sample output.</p>

<h3 id="input-2">Input</h3>

<p>A markdown style text, only using the rules above.</p>

<p>An empty line represents the end of input, and should be ignored.</p>

<p>The total length of the input will not exceed $10^6$.</p>

<h3 id="output-2">Output</h3>

<p>A html format text, each line of input corresponds to each line of output.</p>

<p>You should not output extra whitespaces or emptylines, but a newline at the end of output will be ignored.</p>

<h3 id="sample-input-2">Sample Input</h3>

<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gh"># Welcome</span>
Welcome to <span class="p">[</span><span class="nv">my blog</span><span class="p">](</span><span class="sx">https://ender-coder.github.io/</span><span class="p">)</span>!
<span class="gu">## H2 title</span>

</code></pre></div></div>

<h3 id="sample-output-2">Sample Output</h3>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;h1&gt;</span>Welcome<span class="nt">&lt;/h1&gt;&lt;br/&gt;</span>
Welcome to <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"https://ender-coder.github.io/"</span><span class="nt">&gt;</span>my blog<span class="nt">&lt;/a&gt;</span>!<span class="nt">&lt;br/&gt;</span>
<span class="nt">&lt;h2&gt;</span>H2 title<span class="nt">&lt;/h2&gt;&lt;br/&gt;</span>
</code></pre></div></div>

<h3 id="note-1">Note</h3>

<p>You can output to a â€œhtmlâ€ file and open it with Web browser.</p>

<h3 id="solution-2">Solution</h3>

<p>ä¸€é“æ¯”è¾ƒè€ƒéªŒåŸºæœ¬åŠŸçš„å­—ç¬¦ä¸²å¤„ç†é¢˜ï¼Œä¸€ä¸ªç®€æ˜“çš„Markdownæ¸²æŸ“å™¨ã€‚å‡ºè¿™ä¸ªé¢˜çš„æ—¶å€™ï¼Œæœ¬æ¥æƒ³å†å¢åŠ ä¸€äº›åˆ«çš„è§„åˆ™ï¼ˆæ— åºåˆ—è¡¨ã€æœ‰åºåˆ—è¡¨ã€ä»£ç å—ã€å¼•ç”¨ã€åŠ ç²—ã€æ–œä½“â€¦â€¦ï¼‰çš„ï¼Œä¸è¿‡è€ƒè™‘åˆ°å¤§å®¶çš„æ°´å¹³ï¼Œæœ€åé¢˜ç›®è¿˜æ˜¯è¢«ç®€åŒ–æˆè¿™ä¸ªæ ·å­ï¼Œå¹¶ä¸”è§„åˆ™ä¹‹é—´æ²¡æœ‰åµŒå¥—ï¼Œå¸Œæœ›å¤§å®¶èƒ½å¤Ÿå†™çš„å¼€å¿ƒï¼Œä¸è¦å‡ºæˆæ¯’ç˜¤æ¨¡æ‹Ÿé¢˜ã€‚å¹¶ä¸”ï¼Œè¿™ç¯‡Solutionå°±æ˜¯ä½¿ç”¨Markdownæ’ç‰ˆã€‚</p>

<p>Markdownæ¸²æŸ“å™¨å…¶å®æœ‰å¾ˆå¤šå®ç°ï¼Œå¤§å®¶æœ‰ç©ºå¯ä»¥ç»§ç»­å®Œå–„è‡ªå·±çš„æ¸²æŸ“å™¨æ¡†æ¶ï¼Œç”šè‡³å¯ä»¥å®ç°ä¸€ä¸ªåŸºäºmarkdownçš„åšå®¢å¼•æ“ï¼ˆæ¯”å¦‚ç”¨Rubyå®ç°çš„<a href="https://github.com/jekyll/jekyll">jekyll</a>ï¼Œç”¨Node.jså®ç°çš„<a href="https://github.com/hexojs/hexo">hexo</a>â€¦â€¦ï¼‰ï¼Œç›¸ä¿¡å¯¹ä»£ç èƒ½åŠ›å’Œå·¥ç¨‹èƒ½åŠ›éƒ½ä¼šæœ‰æ¯”è¾ƒå¤§çš„æå‡ã€‚</p>

<p>è€ƒè™‘åˆ°<code class="highlighter-rouge">gets</code>ä¸å®‰å…¨ï¼ˆè¯¦è§<a href="https://zh.cppreference.com/w/cpp/io/c/gets">è¿™é‡Œ</a>ï¼‰ï¼Œæ ‡ç¨‹ä½¿ç”¨äº†<code class="highlighter-rouge">fgets</code>è¿›è¡Œè¯»å…¥ï¼Œä¼šæŠŠæ¢è¡Œç¬¦ä¸€èµ·è¯»è¿›æ¥ï¼Œè¦è®°å¾—å»æ‰ã€‚</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;bits/stdc++.h&gt;
</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">N</span> <span class="o">=</span> <span class="mf">1e6</span> <span class="o">+</span> <span class="mi">9</span><span class="p">;</span>
<span class="kt">char</span> <span class="n">s</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
	<span class="k">for</span> <span class="p">(;</span> <span class="n">fgets</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">stdin</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="sc">'\n'</span><span class="p">;</span> <span class="n">printf</span><span class="p">(</span><span class="s">"&lt;br/&gt;</span><span class="se">\n</span><span class="s">"</span><span class="p">))</span>
	<span class="p">{</span>
		<span class="o">*</span><span class="n">strchr</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="sc">'\n'</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'#'</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="kt">int</span> <span class="n">hn</span> <span class="o">=</span> <span class="n">strchr</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="sc">' '</span><span class="p">)</span> <span class="o">-</span> <span class="n">s</span><span class="p">;</span>
			<span class="n">printf</span><span class="p">(</span><span class="s">"&lt;h%d&gt;%s&lt;/h%d&gt;"</span><span class="p">,</span> <span class="n">hn</span><span class="p">,</span> <span class="n">s</span> <span class="o">+</span> <span class="n">hn</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">hn</span><span class="p">);</span>
			<span class="k">continue</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="sc">'['</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="n">printf</span><span class="p">(</span><span class="s">"%c"</span><span class="p">,</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
				<span class="k">continue</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="kt">int</span> <span class="n">title</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
				<span class="n">link</span> <span class="o">=</span> <span class="n">strchr</span><span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="n">title</span><span class="p">,</span> <span class="sc">'('</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">s</span><span class="p">;</span>
			<span class="n">s</span><span class="p">[</span><span class="n">link</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span> <span class="o">=</span> <span class="n">strchr</span><span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="n">link</span><span class="p">,</span> <span class="sc">')'</span><span class="p">)</span> <span class="o">-</span> <span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="n">printf</span><span class="p">(</span><span class="s">"&lt;a href=</span><span class="se">\"</span><span class="s">%s</span><span class="se">\"</span><span class="s">&gt;%s&lt;/a&gt;"</span><span class="p">,</span> <span class="n">s</span> <span class="o">+</span> <span class="n">link</span><span class="p">,</span> <span class="n">s</span> <span class="o">+</span> <span class="n">title</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><del>æ ·ä¾‹é‡Œçš„<a href="https://ender-coder.github.io/">é“¾æ¥</a>æ˜¯å¯ä»¥ç‚¹çš„</del></p>

<h2 id="werewolves">Werewolves</h2>

<p>â€œWerewolvesâ€ is a popular card game among young people. In the basic game, there are 2 different groups: the werewolves and the villagers. The purpose of each side is to kill all the opponents, and at least one of themselves survives. During each round of the game, the player will debate players they think are werewolves or not.</p>

<p>Since Emily plays quite well in the Werewolves games, her friends decided to confuse her in the following ways: Like â€œPlayer a is a werewolf, or player b is a villagerâ€, the statements they give will contain two pieces of information connected by â€œorâ€ relationships, of which only one is true.</p>

<p>Now Emily is going to point out all the werewolves, so she wants to know if thereâ€™s a situation (even if all of them are werewolves or villagers) that meets the above restrictions.</p>

<h3 id="input-3">Input</h3>

<p>The first line contains an integer $N$, indicating the number of players.</p>

<p>Then follows $N$ lines, i-th line contains $4$ string $X,S,Y,T$, indicating the i-th player tells Emily, â€œPlayer X is a S or Player Y is a T.â€</p>

<p>$1\le N\le 26$</p>

<p>$X,Y\in{â€˜aâ€™,â€™bâ€™,\ldots,â€™zâ€™}$</p>

<p>$S,T\in{â€œvillagerâ€,â€werewolfâ€}$</p>

<h3 id="output-3">Output</h3>

<p>Print a line of lowercase letters denote the werewolves players, separated by white space.</p>

<p>If all players are villagers print â€œAllâ€.</p>

<p>If there are no situation which obey the rules above, print â€œNieâ€ instead.</p>

<p>If there are multiple solutions, any solution will be accepted.</p>

<h3 id="sample-input-1">Sample Input 1</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2
a villager a villager
b werewolf b villager
</code></pre></div></div>

<h3 id="sample-output-1">Sample Output 1</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Nie
</code></pre></div></div>

<h3 id="sample-input-2">Sample Input 2</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2
a villager a werewolf
a werewolf b villager
</code></pre></div></div>

<h3 id="sample-output2">Sample Output2</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>All
</code></pre></div></div>

<h3 id="sample-input-3">Sample Input 3</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>7
a werewolf f werewolf
a werewolf e werewolf
e werewolf f villager
c villager f werewolf
c villager d villager
d villager f villager
c werewolf c villager
</code></pre></div></div>

<h3 id="sample-output-3">Sample Output 3</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>c e f
</code></pre></div></div>

<h3 id="solution-3">Solution</h3>

<p>è¿™é“é¢˜å…¶å®æ˜¯ä¸€é“éå¸¸ç»å…¸çš„2-SATï¼ˆ2å…ƒçº¦æŸï¼‰é—®é¢˜ã€‚è€ƒè™‘è¿‡å‚åŠ æ–°æ‰‹èµ›çš„å¤§å®¶å¯èƒ½éƒ½æ²¡æ€ä¹ˆå­¦è¿‡å›¾è®ºï¼Œæ•°æ®èŒƒå›´æ˜¯è°ƒæ•´æˆç›´æ¥æœç´¢ä¹Ÿå¯ä»¥è¿‡çš„ã€‚</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;bits/stdc++.h&gt;
</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">Graph</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">Vertex</span>
	<span class="p">{</span>
		<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">o</span><span class="p">;</span>
	<span class="p">};</span>
	<span class="k">typedef</span> <span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">Edge</span><span class="p">;</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Vertex</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">;</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Edge</span><span class="o">&gt;</span> <span class="n">e</span><span class="p">;</span>
	<span class="n">Graph</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">v</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">add</span><span class="p">(</span><span class="k">const</span> <span class="n">Edge</span> <span class="o">&amp;</span><span class="n">ed</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">v</span><span class="p">[</span><span class="n">ed</span><span class="p">.</span><span class="n">first</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
		<span class="n">e</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">ed</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">};</span>
<span class="k">struct</span> <span class="n">TwoSat</span> <span class="o">:</span> <span class="n">Graph</span>
<span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">ok</span><span class="p">;</span>
	<span class="n">TwoSat</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">Graph</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">addOR</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="n">add</span><span class="p">({</span><span class="n">a</span> <span class="o">^</span> <span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="p">}),</span> <span class="n">add</span><span class="p">({</span><span class="n">b</span> <span class="o">^</span> <span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="p">});</span> <span class="p">}</span>
	<span class="kt">void</span> <span class="n">addXOR</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="n">addOR</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="n">addOR</span><span class="p">(</span><span class="n">a</span> <span class="o">^</span> <span class="mi">1</span><span class="p">,</span> <span class="n">b</span> <span class="o">^</span> <span class="mi">1</span><span class="p">);</span> <span class="p">}</span>
	<span class="kt">void</span> <span class="n">addXNOR</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="n">addOR</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">^</span> <span class="mi">1</span><span class="p">),</span> <span class="n">addOR</span><span class="p">(</span><span class="n">a</span> <span class="o">^</span> <span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span> <span class="p">}</span>
	<span class="kt">int</span> <span class="n">dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">stak</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ok</span><span class="p">[</span><span class="n">u</span> <span class="o">^</span> <span class="mi">1</span><span class="p">])</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ok</span><span class="p">[</span><span class="n">u</span><span class="p">])</span>
			<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">ok</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">stak</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">u</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">dfs</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">]].</span><span class="n">second</span><span class="p">,</span> <span class="n">stak</span><span class="p">))</span>
				<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="kt">int</span> <span class="n">ask</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">ok</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ok</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">ok</span><span class="p">[</span><span class="n">i</span> <span class="o">^</span> <span class="mi">1</span><span class="p">])</span>
			<span class="p">{</span>
				<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">stak</span><span class="p">;</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">dfs</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">stak</span><span class="p">))</span>
				<span class="p">{</span>
					<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">stak</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
						<span class="n">ok</span><span class="p">[</span><span class="n">stak</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
					<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">dfs</span><span class="p">(</span><span class="n">i</span> <span class="o">^</span> <span class="mi">1</span><span class="p">,</span> <span class="n">stak</span><span class="p">))</span>
						<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">};</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">n</span><span class="p">;</span>
	<span class="n">scanf</span><span class="p">(</span><span class="s">"%d"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">);</span>
	<span class="n">TwoSat</span> <span class="n">g</span><span class="p">(</span><span class="n">n</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="kt">char</span> <span class="n">x</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="mi">9</span><span class="p">];</span>
		<span class="n">scanf</span><span class="p">(</span><span class="s">"%s%s%s%s"</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">t</span><span class="p">);</span>
		<span class="n">g</span><span class="p">.</span><span class="n">addXOR</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="sc">'a'</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span> <span class="o">|</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'w'</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="sc">'a'</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span> <span class="o">|</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'w'</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">g</span><span class="p">.</span><span class="n">ask</span><span class="p">())</span>
		<span class="k">return</span> <span class="n">printf</span><span class="p">(</span><span class="s">"Nie"</span><span class="p">),</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">g</span><span class="p">.</span><span class="n">ok</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">)</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">g</span><span class="p">.</span><span class="n">ok</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
			<span class="n">printf</span><span class="p">(</span><span class="s">"%c "</span><span class="p">,</span> <span class="sc">'a'</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)),</span> <span class="o">++</span><span class="n">n</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">n</span><span class="p">)</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">"All"</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ç„¶è€Œï¼Œè¿™ä¸€ç±»é—®é¢˜å…¶å®æ˜¯æœ‰ç»å…¸çš„å›¾è®ºè§£æ³•çš„ã€‚é—®é¢˜å¯ä»¥æŠ½è±¡æˆï¼Œå¯¹äº$n$ä¸ªå¸ƒå°”å˜é‡$x_0\ldots x_{n-1}$ï¼Œé€»è¾‘è¡¨è¾¾å¼$Y=(A_0+B_0)(A_1+B_1)\ldots(A_{m-1}+B_{m-1})$ï¼Œå…¶ä¸­$A_i,B_i\in{x_j,\overline{x_j}}$ï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨$x_0\ldots x_{n-1}$çš„å–å€¼ä½¿å¾—Yå€¼ä¸º1ã€‚å¯¹äºæœ¬é¢˜ä¸­è¦æ±‚å¼‚æˆ–å…³ç³»ï¼Œå¯ä»¥è¿™æ ·è½¬æ¢ï¼š$A \oplus B=(A+B)(\overline{A}+\overline{B})$ã€‚</p>

<p>åœ¨è¿™ä¸ªé—®é¢˜é‡Œï¼ŒæŸä¸ªç©å®¶æ˜¯å¦æ˜¯ç‹¼äººèƒ½æ„æˆå¸ƒå°”å˜é‡ï¼Œæˆ‘ä»¬æŠŠæ¯ä¸ªç‹¼äººæ‹†ä¸¤ä¸ªç‚¹å»ºå›¾ï¼Œåˆ†åˆ«å¯¹åº”æ˜¯ç‹¼äººçš„æƒ…å†µå’Œä¸æ˜¯ç‹¼äººçš„æƒ…å†µã€‚å› ä¸º$A+B=(\overline A\to B)(\overline B\to A)$ï¼Œæ‰€ä»¥å¯¹äºä¸€ä¸ªè¦æ±‚$A+B$ï¼Œæˆ‘ä»¬è¿$\overline A\to B,\overline B\to A$ä¸¤æ¡è¾¹ã€‚å¦‚æœæœ‰ä¸€æ¡è¾¹$A\to B$ï¼Œæ„å‘³ç€å¦‚æœAæˆç«‹é‚£ä¹ˆBå¿…ç„¶æˆç«‹ã€‚è¿™æ ·æˆ‘ä»¬å°±å»ºå¥½å›¾äº†ã€‚</p>

<p>å¦‚æœ$\exists i,x_i,\overline{x_i}\in$åŒä¸€SCCï¼ˆStrongly Connected Componenetï¼Œå¼ºè¿é€šåˆ†é‡ï¼‰ï¼Œåˆ™ä¸å­˜åœ¨ã€‚æ±‚SCCå¯ä»¥ä½¿ç”¨çº¿æ€§å¤æ‚åº¦çš„<a href="https://wu-kan.github.io/posts/acm/template/%E5%9B%BE%E8%AE%BA#%E6%97%A0%E5%90%91%E5%9B%BE%E6%B1%82%E8%BE%B9%E5%8F%8C%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F%E6%9C%89%E5%90%91%E5%9B%BE%E6%B1%82%E5%BC%BA%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F">Tarjanç®—æ³•</a>ï¼Œå¯ä»¥è‡ªè¡Œå­¦ä¹ ã€‚è¿™æ ·æˆ‘ä»¬å°±åˆ¤æ–­äº†æ˜¯å¦æœ‰è§£ã€‚</p>

<p>ä¸‹é¢æˆ‘ä»¬å†æ¥æ„é€ ä¸€ç»„å¯è¡Œè§£ã€‚å°†ä½¿ç”¨Tarjanç®—æ³•ç¼©ç‚¹åçš„æ£®æ—ä¸­æ¯æ¡è¾¹åå‘ï¼ŒæŒ‰ç…§æ‹“æ‰‘åºï¼ˆå› ä¸ºå·²ç»è¿›è¡Œç¼©ç‚¹ï¼Œæ‰€ä»¥ä¸å­˜åœ¨ç¯è·¯ï¼‰è¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š</p>

<ol>
  <li>åˆå§‹æ—¶æ‰€æœ‰èŠ‚ç‚¹ä¸ºæ— è‰²ã€‚</li>
  <li>è‹¥å½“å‰èŠ‚ç‚¹æœªè¢«æŸ“è‰²ï¼ŒæŸ“æˆçº¢è‰²ï¼Œç„¶åå°†æ‰€æœ‰äº’æ–¥ç‚¹æ‰€åœ¨æœ‰å‘å­æ ‘ä¸­çš„ç‚¹å…¨éƒ¨æŸ“æˆé»‘è‰²ã€‚</li>
  <li>å¦åˆ™ä»€ä¹ˆéƒ½ä¸åšï¼Œç»§ç»­å¤„ç†ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚</li>
</ol>

<p>å®¹æ˜“è¯æ˜ä¸Šè¿°æ“ä½œä¸ä¼šä½¿åŒä¸€ä¸ªèŠ‚ç‚¹è¢«æŸ“ä¸Šä¸¤ç§é¢œè‰²ï¼Œæœ€ç»ˆçº¢ç‚¹é›†æ„æˆä¸€ç»„è§£ã€‚æ—¶é—´å¤æ‚åº¦$O(\mid V \mid +\mid E \mid)$ï¼Œå…¶ä¸­$V$æ˜¯é¡¶ç‚¹é›†ï¼Œ$E$æ˜¯è¾¹é›†ã€‚</p>

<p>æœ€ç»ˆæ€»çš„æ—¶é—´å¤æ‚åº¦æ˜¯$O(N)$ï¼Œè¿œè¿œå¥½äºé¢˜ç›®è¦æ±‚çš„$1\le N\le 26$ã€‚</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;bits/stdc++.h&gt;
</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">Graph</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">Vertex</span>
	<span class="p">{</span>
		<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">o</span><span class="p">;</span>
	<span class="p">};</span>
	<span class="k">typedef</span> <span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">Edge</span><span class="p">;</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Vertex</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">;</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Edge</span><span class="o">&gt;</span> <span class="n">e</span><span class="p">;</span>
	<span class="n">Graph</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">v</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">add</span><span class="p">(</span><span class="k">const</span> <span class="n">Edge</span> <span class="o">&amp;</span><span class="n">ed</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">v</span><span class="p">[</span><span class="n">ed</span><span class="p">.</span><span class="n">first</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
		<span class="n">e</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">ed</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">};</span>
<span class="k">struct</span> <span class="n">StronglyConnectedComponenet</span> <span class="o">:</span> <span class="n">Graph</span>
<span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">dep</span><span class="p">,</span> <span class="n">sid</span><span class="p">,</span> <span class="n">stak</span><span class="p">;</span> <span class="c1">//sid=ç‚¹æ‰€å±è¿é€šå—å†…ä¸€ç‚¹</span>
	<span class="n">StronglyConnectedComponenet</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">Graph</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">ask</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">dep</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
		<span class="n">sid</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">dep</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">())</span>
				<span class="n">dfs</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
	<span class="p">}</span>
	<span class="kt">int</span> <span class="n">dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">fa</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="kt">int</span> <span class="n">low</span> <span class="o">=</span> <span class="n">dep</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">fa</span> <span class="o">!=</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">?</span> <span class="n">dep</span><span class="p">[</span><span class="n">fa</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">stak</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">u</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">to</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">to</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">,</span> <span class="n">to</span> <span class="o">!=</span> <span class="n">fa</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c1">//æ±‚å¼ºè¿é€šåˆ†é‡æŠŠæ³¨é‡Šå»æ‰ï¼Œå³å…è®¸èµ°å›è¾¹</span>
			<span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">dep</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">())</span>
					<span class="n">low</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">dfs</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">u</span><span class="p">));</span>
				<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">sid</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">())</span>
					<span class="n">low</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">dep</span><span class="p">[</span><span class="n">to</span><span class="p">]);</span>
			<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">low</span> <span class="o">==</span> <span class="n">dep</span><span class="p">[</span><span class="n">u</span><span class="p">])</span>
			<span class="k">for</span> <span class="p">(;;)</span>
			<span class="p">{</span>
				<span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="n">stak</span><span class="p">.</span><span class="n">back</span><span class="p">();</span>
				<span class="n">stak</span><span class="p">.</span><span class="n">pop_back</span><span class="p">();</span>
				<span class="n">sid</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span><span class="p">;</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="n">u</span><span class="p">)</span>
					<span class="k">break</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="k">return</span> <span class="n">low</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">};</span>
<span class="k">struct</span> <span class="n">TwoSat</span> <span class="o">:</span> <span class="n">StronglyConnectedComponenet</span>
<span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">ok</span><span class="p">;</span>
	<span class="n">TwoSat</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">StronglyConnectedComponenet</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">addOR</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="n">add</span><span class="p">({</span><span class="n">a</span> <span class="o">^</span> <span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="p">}),</span> <span class="n">add</span><span class="p">({</span><span class="n">b</span> <span class="o">^</span> <span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="p">});</span> <span class="p">}</span>
	<span class="kt">void</span> <span class="n">addXOR</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="n">addOR</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="n">addOR</span><span class="p">(</span><span class="n">a</span> <span class="o">^</span> <span class="mi">1</span><span class="p">,</span> <span class="n">b</span> <span class="o">^</span> <span class="mi">1</span><span class="p">);</span> <span class="p">}</span>
	<span class="kt">void</span> <span class="n">addXNOR</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="n">addOR</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">^</span> <span class="mi">1</span><span class="p">),</span> <span class="n">addOR</span><span class="p">(</span><span class="n">a</span> <span class="o">^</span> <span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span> <span class="p">}</span>
	<span class="kt">int</span> <span class="n">ask</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">StronglyConnectedComponenet</span><span class="o">::</span><span class="n">ask</span><span class="p">();</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">sid</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">sid</span><span class="p">[</span><span class="n">i</span> <span class="o">^</span> <span class="mi">1</span><span class="p">])</span>
				<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">vector</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">g</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
		<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">ind</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">),</span> <span class="n">cf</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">),</span> <span class="n">stak</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">cf</span><span class="p">[</span><span class="n">sid</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">sid</span><span class="p">[</span><span class="n">i</span> <span class="o">^</span> <span class="mi">1</span><span class="p">];</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">sid</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="n">k</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">o</span><span class="p">[</span><span class="n">j</span><span class="p">]].</span><span class="n">second</span><span class="p">]</span> <span class="o">!=</span> <span class="n">sid</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
					<span class="n">g</span><span class="p">[</span><span class="n">sid</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">]].</span><span class="n">push_back</span><span class="p">(</span><span class="n">sid</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="o">++</span><span class="n">ind</span><span class="p">[</span><span class="n">sid</span><span class="p">[</span><span class="n">i</span><span class="p">]];</span>
		<span class="p">}</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">sid</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">ind</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
				<span class="n">stak</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">ok</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span> <span class="o">!</span><span class="n">stak</span><span class="p">.</span><span class="n">empty</span><span class="p">();)</span>
		<span class="p">{</span>
			<span class="kt">int</span> <span class="n">u</span> <span class="o">=</span> <span class="n">stak</span><span class="p">.</span><span class="n">back</span><span class="p">();</span>
			<span class="n">stak</span><span class="p">.</span><span class="n">pop_back</span><span class="p">();</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">ok</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
				<span class="n">ok</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ok</span><span class="p">[</span><span class="n">cf</span><span class="p">[</span><span class="n">u</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">g</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">!--</span><span class="n">ind</span><span class="p">[</span><span class="n">g</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">i</span><span class="p">]])</span>
					<span class="n">stak</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">i</span><span class="p">]);</span>
		<span class="p">}</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">sid</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
				<span class="n">ok</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ok</span><span class="p">[</span><span class="n">sid</span><span class="p">[</span><span class="n">i</span><span class="p">]];</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">};</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">n</span><span class="p">;</span>
	<span class="n">scanf</span><span class="p">(</span><span class="s">"%d"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">);</span>
	<span class="n">TwoSat</span> <span class="n">g</span><span class="p">(</span><span class="n">n</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="kt">char</span> <span class="n">x</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="mi">9</span><span class="p">];</span>
		<span class="n">scanf</span><span class="p">(</span><span class="s">"%s%s%s%s"</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">t</span><span class="p">);</span>
		<span class="n">g</span><span class="p">.</span><span class="n">addXOR</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="sc">'a'</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span> <span class="o">|</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'w'</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="sc">'a'</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span> <span class="o">|</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'w'</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">g</span><span class="p">.</span><span class="n">ask</span><span class="p">())</span>
		<span class="k">return</span> <span class="n">printf</span><span class="p">(</span><span class="s">"Nie"</span><span class="p">),</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">g</span><span class="p">.</span><span class="n">ok</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">)</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">g</span><span class="p">.</span><span class="n">ok</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
			<span class="n">printf</span><span class="p">(</span><span class="s">"%c "</span><span class="p">,</span> <span class="sc">'a'</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)),</span> <span class="o">++</span><span class="n">n</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">n</span><span class="p">)</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">"All"</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="tianhe-2a">TianHe-2A</h2>

<p>TianHe-2 is the fastest supercomputer in the world from June 2013 to June 2016. In September 2017, National Supercomputer Center in Guangzhou announced to upgrade TianHe-2 supercomputing system by the end of the year, replacing the original Intel Xeon Phi accelerator with the domestic accelerator matrix 2000. The upgraded TianHe-2 is called TianHe-2A. The number of nodes has increased from 16000 to 17792, and the floating-point performance has increased from 54.9pflops to 94.97pflops.</p>

<p>During a TianHe-2Aâ€™s schedule, the cluster workload manager allocates $n$ computing nodes to users so they can perform work. To simplify this problem, all the $n$ computing nodes are considered to be in a line from left to right and indexed from $0$ to $n-1$. At the beginning each node $i$ holds a nonnegative integer $a_i$. Then the nodes are ready to work, by executing any of the following commands:</p>

<ul>
  <li>$div\,l\,r\,w$: $\forall i \in [l,r],a_i\to \lfloor\frac{a_i}{w}\rfloor$</li>
  <li>$sqr\,l\,r$: $\forall i \in [l,r],a_i\to \lfloor\sqrt{a_i}\rfloor$</li>
  <li>$phi\,l\,r$: $\forall i \in [l,r],a_i\to \phi(a_i)$</li>
  <li>$ask\,l\,r$: Ask the max value from $a_l$ to $a_r$.</li>
</ul>

<p>Now WuK wants you to simulate the operation of Tianhe-2A.</p>

<h3 id="input-4">Input</h3>

<p>The first line of the input gives the number of test cases, $t$. $t$ test cases follow.</p>

<p>Each test case starts with a line containing two integers $n,m$, the number of computing nodes and the number of opeartions.</p>

<p>The next line contains $n$ integers $a_0,a_1,\ldots,a_{n-1}$.</p>

<p>Then, there are $m$ more lines, each line contains a command as before.</p>

<p>$1&lt;t\leq 20$</p>

<p>$0&lt;n,m,w\leq17792$, and $w$ is an integer</p>

<p>$0\le l\le r&lt;n$</p>

<p>$\forall i \in [0,n),0\le a_i&lt;17792$</p>

<h3 id="output-4">Output</h3>

<p>For each $ask$ command, you are asked to output a integer on a new line.</p>

<h3 id="sample-input-3">Sample Input</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1
10 10
0 1 2 3 4 5 6 7 8 9
ask 0 4
phi 4 4
ask 4 4
ask 0 4
ask 6 9
sqr 5 9
ask 7 7
ask 9 9
div 0 9 3
ask 0 9
</code></pre></div></div>

<h3 id="sample-output-3">Sample Output</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>4
2
3
9
2
3
1
</code></pre></div></div>

<h3 id="note-2">Note</h3>

<p>The Euler function $\phi$ is an important kind of function in number theory, $\phi(n)$ represents the amount of the numbers which are smaller than n and coprime to n, and this function has a lot of beautiful characteristics.</p>

<p>Let me put it another way, Euler function $\phi(i)=\sum_{j=1}^{i-1}[\gcd(i,j)=1]$. Moreover, $\phi(0)=0,\phi(1)=1,\phi(2)=1,\phi(3)=2,\phi(4)=2,\ldots$</p>

<h3 id="solution-4">Solution</h3>

<p>è£¸çš„çº¿æ®µæ ‘ï¼Œé¡ºä¾¿æ™®åŠä¸€ä¸‹è¶…ç®—çŸ¥è¯†ã€‚è¦ç”¨çº¿æ®µæ ‘ç»´æŠ¤åŒºé—´æœ€å¤§å€¼ï¼Œæ”¯æŒçš„ä¿®æ”¹æ“ä½œæ˜¯åŒºé—´å¼€æ–¹ã€åŒºé—´æ•´é™¤ã€åŒºé—´æ¬§æ‹‰å‡½æ•°å˜æ¢ã€‚</p>

<p>è¿™ä¸€é¢˜çš„å‡ºé¢˜çµæ„Ÿæ¥è‡ªäº<a href="https://wu-kan.github.io/posts/acm/%E9%A2%98%E8%A7%A3/The-Preliminary-Contest-for-ICPC-Asia-Nanjing-2019#super_log">å—äº¬ç½‘ç»œèµ›çš„super_log</a>è¿™ä¸€é¢˜ï¼šæ¬§æ‹‰å‡½æ•°çš„å˜æ¢æ”¶æ•›é€Ÿåº¦éå¸¸å¿«ã€‚åœ¨è¿™ä¸ªé¢˜é‡Œï¼Œ17792ä»¥å†…çš„æ•°è‡³å¤šå˜æ¢27æ¬¡å°±ä¼šæ”¶æ•›åˆ°1ï¼Œå› æ­¤æˆ‘ä»¬åœ¨ä¿®æ”¹çš„æ—¶å€™æ£€æŸ¥ä¸€ä¸‹å½“å‰åŒºé—´æœ€å¤§å€¼ï¼Œå¦‚æœå°äºç­‰äº1æˆ‘ä»¬å°±å¯ä»¥æå‰é€€å‡ºè¿™ä¸ªåŒºé—´çš„ä¿®æ”¹ã€‚è¿™æ ·ï¼Œçº¿æ®µæ ‘æ¯ä¸ªèŠ‚ç‚¹è¢«ä¿®æ”¹çš„æ¬¡æ•°éƒ½ä¸ä¼šè¶…è¿‡27æ¬¡ï¼Œæ—¶é—´ä¸Šå®Œå…¨æ²¡é—®é¢˜ã€‚æ¬§æ‹‰å‡½æ•°å˜æ¢æˆ‘ä»¬å¯ä»¥å…ˆç”¨çº¿æ€§<a href="https://wu-kan.github.io/posts/acm/template/%E6%95%B0%E8%AE%BA#%E6%AC%A7%E6%8B%89%E7%AD%9B">æ¬§æ‹‰ç­›</a>ç®—å‡º17792ä»¥å†…æ‰€æœ‰æ•°çš„æ¬§æ‹‰å‡½æ•°ï¼›è€ƒè™‘åˆ°æ–°æ‰‹å¯èƒ½ä¸ä¼šæ¬§æ‹‰ç­›ï¼Œè¿™é‡Œå¦‚æœä½¿ç”¨$O(\sqrt{n})$çš„<a href="https://wu-kan.github.io/posts/acm/template/%E6%95%B0%E8%AE%BA#%E7%9B%B4%E6%8E%A5%E6%B1%82%E6%AC%A7%E6%8B%89%E5%87%BD%E6%95%B0">æš´åŠ›æ±‚æ¬§æ‹‰å‡½æ•°</a>åº”è¯¥ä¹Ÿæ˜¯å¯ä»¥è¿‡çš„ã€‚<del>ä»€ä¹ˆï¼Œä½ $O(n\log n)$æ±‚å•ä¸ªæ¬§æ‹‰å‡½æ•°ï¼Ÿ</del></p>

<p>åŒºé—´æ•´é™¤ä¹Ÿæ˜¯åŒç†ï¼Œåªä¸è¿‡è¦ç‰¹æ®Šåˆ¤æ–­ä¸€ä¸‹é™¤æ•°ä¸º1çš„æ—¶å€™ä¹Ÿè¦æå‰é€€å‡ºå»ï¼ˆæœ‰ä¸€ç»„æ•°æ®é™¤æ•°å…¨ä¸º1ï¼‰ï¼Œå¦åˆ™æ°¸è¿œä¸ä¼šæ”¶æ•›ï¼Œå¤æ‚åº¦ä¼šè¢«å¡åˆ°$O(n^2)$ã€‚</p>

<p>åŒºé—´å¼€æ–¹åŒç†ï¼Œæ˜¯ä¸‰ä¸ªæ“ä½œé‡Œé¢å¥—è·¯æœ€å°‘ã€æœ€ç®€å•çš„ã€‚</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;bits/stdc++.h&gt;
</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">N</span> <span class="o">=</span> <span class="mi">17792</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">EulerSieve</span>
<span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">p</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">phi</span><span class="p">;</span>
	<span class="n">EulerSieve</span><span class="p">(</span><span class="kt">int</span> <span class="n">N</span><span class="p">)</span> <span class="o">:</span> <span class="n">m</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">phi</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">long</span> <span class="kt">long</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">k</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
				<span class="n">p</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">),</span> <span class="n">phi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">p</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">p</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="n">phi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">phi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">p</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
				<span class="k">if</span> <span class="p">((</span><span class="n">m</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">==</span> <span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
					<span class="k">break</span><span class="p">;</span>
				<span class="n">phi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-=</span> <span class="n">phi</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span> <span class="n">e</span><span class="p">(</span><span class="n">N</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">t</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
<span class="k">struct</span> <span class="n">SegmentTree</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">val</span><span class="p">;</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">SegmentTree</span><span class="o">&gt;</span> <span class="n">ch</span><span class="p">;</span>
	<span class="n">SegmentTree</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">)</span> <span class="o">:</span> <span class="n">l</span><span class="p">(</span><span class="n">l</span><span class="p">),</span> <span class="n">r</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="n">val</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">l</span><span class="p">])</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">l</span> <span class="o">&gt;=</span> <span class="n">r</span><span class="p">)</span>
			<span class="k">return</span><span class="p">;</span>
		<span class="kt">int</span> <span class="n">m</span> <span class="o">=</span> <span class="n">l</span> <span class="o">+</span> <span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="n">l</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">ch</span> <span class="o">=</span> <span class="p">{{</span><span class="n">l</span><span class="p">,</span> <span class="n">m</span><span class="p">},</span> <span class="p">{</span><span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">r</span><span class="p">}};</span>
		<span class="n">val</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">val</span><span class="p">,</span> <span class="n">ch</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">val</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">div</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">,</span> <span class="kt">int</span> <span class="n">w</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="o">||</span> <span class="n">w</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
			<span class="k">return</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">l</span> <span class="o">&gt;=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">val</span> <span class="o">/=</span> <span class="n">w</span><span class="p">;</span>
			<span class="k">return</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">&lt;=</span> <span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">r</span><span class="p">)</span>
			<span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">div</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">w</span><span class="p">);</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">l</span> <span class="o">&gt;=</span> <span class="n">ch</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">l</span><span class="p">)</span>
			<span class="n">ch</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">div</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">w</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">div</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">r</span><span class="p">,</span> <span class="n">w</span><span class="p">),</span> <span class="n">ch</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">div</span><span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">w</span><span class="p">);</span>
		<span class="n">val</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">val</span><span class="p">,</span> <span class="n">ch</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">val</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">sqr</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span>
			<span class="k">return</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">l</span> <span class="o">&gt;=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">val</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">val</span><span class="p">);</span>
			<span class="k">return</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">&lt;=</span> <span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">r</span><span class="p">)</span>
			<span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">sqr</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">l</span> <span class="o">&gt;=</span> <span class="n">ch</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">l</span><span class="p">)</span>
			<span class="n">ch</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">sqr</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">sqr</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">r</span><span class="p">),</span> <span class="n">ch</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">sqr</span><span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>
		<span class="n">val</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">val</span><span class="p">,</span> <span class="n">ch</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">val</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">phi</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span>
			<span class="k">return</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">l</span> <span class="o">&gt;=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">val</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="n">phi</span><span class="p">[</span><span class="n">val</span><span class="p">];</span>
			<span class="k">return</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">&lt;=</span> <span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">r</span><span class="p">)</span>
			<span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">phi</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">l</span> <span class="o">&gt;=</span> <span class="n">ch</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">l</span><span class="p">)</span>
			<span class="n">ch</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">phi</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">phi</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">r</span><span class="p">),</span> <span class="n">ch</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">phi</span><span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>
		<span class="n">val</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">val</span><span class="p">,</span> <span class="n">ch</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">val</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="kt">int</span> <span class="n">ask</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">l</span> <span class="o">&lt;=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">l</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">r</span> <span class="o">&lt;=</span> <span class="n">r</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">val</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">&lt;=</span> <span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">r</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">ask</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">l</span> <span class="o">&gt;=</span> <span class="n">ch</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">l</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">ch</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">ask</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">max</span><span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">ask</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">r</span><span class="p">),</span> <span class="n">ch</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">ask</span><span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">));</span>
	<span class="p">}</span>
<span class="p">};</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">scanf</span><span class="p">(</span><span class="s">"%d"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">t</span><span class="p">);</span> <span class="n">t</span><span class="o">--</span><span class="p">;)</span>
	<span class="p">{</span>
		<span class="n">scanf</span><span class="p">(</span><span class="s">"%d%d"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">m</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="n">scanf</span><span class="p">(</span><span class="s">"%d"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
		<span class="n">SegmentTree</span> <span class="n">t</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">w</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">m</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="kt">char</span> <span class="n">s</span><span class="p">[</span><span class="mi">9</span><span class="p">];</span>
			<span class="n">scanf</span><span class="p">(</span><span class="s">"%s%d%d"</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">r</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">"div"</span><span class="p">))</span>
				<span class="n">scanf</span><span class="p">(</span><span class="s">"%d"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">w</span><span class="p">),</span> <span class="n">t</span><span class="p">.</span><span class="n">div</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">w</span><span class="p">);</span>
			<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">"sqr"</span><span class="p">))</span>
				<span class="n">t</span><span class="p">.</span><span class="n">sqr</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>
			<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">"phi"</span><span class="p">))</span>
				<span class="n">t</span><span class="p">.</span><span class="n">phi</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>
			<span class="k">else</span>
				<span class="n">printf</span><span class="p">(</span><span class="s">"%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">t</span><span class="p">.</span><span class="n">ask</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">));</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><del>å‘½é¢˜ç»„æ—¥å¸¸ï¼ŒEé¢˜åˆè¢«æ°´è¿‡å»äº†</del></p>

<p><img src="/public/image/2019-12-15-1.jpg" alt="Eé¢˜åˆè¢«æ°´è¿‡å»äº†" /></p>

:ET