I"T£<h2 id="å®éªŒé¢˜ç›®">å®éªŒé¢˜ç›®</h2>

<p>Echoå®éªŒ</p>

<h2 id="å®éªŒç›®çš„">å®éªŒç›®çš„</h2>

<p>æŒæ¡å¥—èŠ‚å­—çš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•</p>

<h2 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h2>

<ul>
  <li>https://www.cnblogs.com/hgwang/p/6074038.html  ï¼ˆå¥—æ¥å­—ï¼‰</li>
  <li>https://www.jb51.net/article/37410.htm  ï¼ˆå­—ç¬¦ä¸²ï¼‰</li>
  <li>https://docs.microsoft.com/en-us/c/c-runtime-library/stream-i-o?view=vs-2017  ï¼ˆå­—ç¬¦ä¸²ï¼‰</li>
  <li>https://docs.microsoft.com/en-us/c/c-runtime-library/reference/crt-alphabetical-function-reference?view=vs-2017#s   ï¼ˆå­—ç¬¦ä¸²ï¼‰</li>
  <li>http://www.runoob.com/cprogramming/  ï¼ˆå­—ç¬¦ä¸²ï¼‰</li>
</ul>

<h2 id="å®éªŒç¯å¢ƒ">å®éªŒç¯å¢ƒ</h2>

<ul>
  <li>Windows + VS 2012  http://172.18.187.9/netdisk/default.aspx?vm=17net</li>
  <li>å¯¹äºVS2015å’ŒVS2017é»˜è®¤ä½¿ç”¨å®‰å…¨å‘¨æœŸæ£€æŸ¥ï¼Œå¦‚æœä¸å…³é—­VSçš„å®‰å…¨å‘¨æœŸæ£€æŸ¥ï¼Œå¾ˆå¤šå­—ç¬¦ä¸²å‡½æ•°éƒ½ä¸èƒ½ç”¨ã€‚</li>
  <li>Linux + gcc</li>
</ul>

<p>è¿™é‡Œæˆ‘ä½¿ç”¨çš„ç¯å¢ƒæ˜¯Windows 10 + VSCode + gcc version 8.1.0 (x86_64-posix-sjlj-rev0, Built by MinGW-W64 project)</p>
<h2 id="å®éªŒå†…å®¹">å®éªŒå†…å®¹</h2>

<h3 id="ç¼–å†™tcp-echoå¢å¼ºç¨‹åº">ç¼–å†™TCP Echoå¢å¼ºç¨‹åº</h3>

<h4 id="å®éªŒè¦æ±‚">å®éªŒè¦æ±‚ï¼š</h4>

<p>æœåŠ¡å™¨æŠŠå®¢æˆ·ç«¯å‘é€æ¥çš„ä»»ä½•æ¶ˆæ¯éƒ½è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œè¿”å›çš„æ¶ˆæ¯å‰é¢è¦åŠ ä¸ŠæœåŠ¡å™¨çš„å½“å‰æ—¶é—´ã€‚å®¢æˆ·ç«¯æŠŠè¿”å›çš„æ¶ˆæ¯æ˜¾ç¤ºå‡ºæ¥ã€‚å®¢æˆ·ç«¯æ¯è¾“å…¥ä¸€æ¡æ¶ˆæ¯å°±å»ºç«‹TCPè¿æ¥ï¼Œå¹¶æŠŠæ¶ˆæ¯å‘é€ç»™æœåŠ¡å™¨ï¼Œåœ¨æ”¶åˆ°æœåŠ¡å™¨å›åº”åå…³é—­è¿æ¥ã€‚åœ¨è¿™ä¸€åŸºç¡€ä¸Šï¼ŒæœåŠ¡å™¨åœ¨æ”¶åˆ°å®¢æˆ·ç«¯çš„æ¶ˆæ¯æ—¶æ˜¾ç¤ºæœåŠ¡å™¨çš„å½“å‰æ—¶é—´ã€å®¢æˆ·ç«¯çš„IPåœ°å€ã€å®¢æˆ·ç«¯çš„ç«¯å£å·å’Œå®¢æˆ·ç«¯å‘æ¥çš„ä¿¡æ¯ï¼Œå¹¶æŠŠå®ƒä»¬ä¸€å¹¶è¿”å›ç»™å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯åœ¨å‘é€æ¶ˆæ¯åæŠŠæœåŠ¡å™¨å‘å›ç»™å®ƒçš„æ¶ˆæ¯æ˜¾ç¤ºå‡ºæ¥ã€‚è¦æ±‚æœåŠ¡å™¨ç›´æ¥ä»accept()çš„å‚æ•°fsinä¸­å¾—åˆ°å®¢æˆ·ç«¯çš„IPåœ°å€å’Œç«¯å£å·ã€‚æœåŠ¡å™¨è·å–IPåœ°å€åè¦æ±‚ç›´æ¥ä½¿ç”¨s_un_bçš„å››ä¸ªåˆ†é‡å¾—åˆ°IPåœ°å€ï¼Œä¸èƒ½ä½¿ç”¨å‡½æ•°inet_ntoa()è½¬æ¢IPåœ°å€ã€‚</p>

<h4 id="åªè¿è¡Œå®¢æˆ·ç«¯ç¨‹åºè€Œä¸è¿è¡ŒæœåŠ¡å™¨ç¨‹åºä¼šå‡ºç°ä»€ä¹ˆé”™è¯¯æˆªå±å¹¶è¯´æ˜åŸå› ">åªè¿è¡Œå®¢æˆ·ç«¯ç¨‹åºè€Œä¸è¿è¡ŒæœåŠ¡å™¨ç¨‹åºä¼šå‡ºç°ä»€ä¹ˆé”™è¯¯ï¼Œæˆªå±å¹¶è¯´æ˜åŸå› ã€‚</h4>

<p><img src="/public/image/2019-03-11-1.jpg" alt="å›¾ç‰‡æè¿°" />
å¦‚å›¾ï¼Œé€€å‡ºäº†æœåŠ¡å™¨ç¨‹åºåå†è¿è¡Œå®¢æˆ·ç«¯ç¨‹åºï¼Œå¾—åˆ°äº†10057çš„æŠ¥é”™ã€‚</p>

<h4 id="æœåŠ¡å™¨å¦‚ä½•å¯ä»¥é€€å‡ºå¾ªç¯">æœåŠ¡å™¨å¦‚ä½•å¯ä»¥é€€å‡ºå¾ªç¯ï¼Ÿ</h4>

<p>kbhit()åœ¨æ‰§è¡Œæ—¶,æ£€æµ‹æ˜¯å¦æœ‰æŒ‰é”®æŒ‰ä¸‹,æœ‰æŒ‰ä¸‹è¿”å›é0å€¼ï¼Œæ²¡æœ‰æŒ‰ä¸‹åˆ™è¿”å›0ï¼Œæ˜¯éé˜»å¡å‡½æ•°ï¼›å› æ­¤ï¼Œé¢„æœŸåœ¨ç›‘å¬çš„è¿‡ç¨‹ä¸­å°†æœåŠ¡å™¨ç¨‹åºä»åå°æ¿€æ´»å¹¶æŒ‰ä¸‹é”®ç›˜æŒ‰é”®å³å¯é€€å‡ºå¾ªç¯ã€‚</p>

<p>ç„¶è€Œï¼Œåœ¨å®é™…è¿è¡Œä¸­è¿™æ ·æ˜¯å¤±æ•ˆçš„ï¼Œæ­£æ˜¯å› ä¸ºä»–æ˜¯éé˜»å¡å‡½æ•°ï¼Œè€Œä¸‹é¢æ”¶å‘ä¿¡æ¯å´æ˜¯é˜»å¡çš„ã€‚å› æ­¤é€€å‡ºå¾ªç¯åªæœ‰æˆ‘ä»¬åœ¨å‘½ä»¤è¡Œä¸­æ‰‹åŠ¨æŒ‰Ctrl+Cäº†ã€‚</p>

<h4 id="æˆªå±ctrlaltprintscreenæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„è¿è¡Œç»“æœæ³¨æ˜å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨">æˆªå±ï¼ˆctrl+alt+PrintScreenï¼‰æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„è¿è¡Œç»“æœï¼ˆæ³¨æ˜å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ï¼‰</h4>

<p>å®¢æˆ·ç«¯ï¼š
<img src="/public/image/2019-03-11-2.jpg" alt="å›¾ç‰‡æè¿°" />
æœåŠ¡å™¨ï¼š
<img src="/public/image/2019-03-11-3.jpg" alt="å›¾ç‰‡æè¿°" /></p>

<h4 id="æœåŠ¡å™¨çš„å…¨éƒ¨æºä»£ç æˆ–è‡ªé€‰ä¸»è¦ä»£ç ">æœåŠ¡å™¨çš„å…¨éƒ¨æºä»£ç ï¼ˆæˆ–è‡ªé€‰ä¸»è¦ä»£ç ï¼‰</h4>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
#include &lt;time.h&gt;
#include &lt;winsock2.h&gt;
#include &lt;conio.h&gt;
#define BUFLEN 2000
#define WSVERS MAKEWORD(2, 0)
#pragma comment(lib, "ws2_32.lib") //ä½¿ç”¨winsock 2.2 library
</span><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>   <span class="c1">// argc: å‘½ä»¤è¡Œå‚æ•°ä¸ªæ•°ï¼Œä¾‹å¦‚ï¼šC:\&gt; TCPServer 8080 argc=2 argv[0]=â€œTCPServer", argv[1]="8080"</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="n">fsin</span><span class="p">;</span> <span class="c1">// the from address of a client</span>
	<span class="n">SOCKET</span> <span class="n">msock</span><span class="p">,</span> <span class="n">ssock</span><span class="p">;</span>	 <span class="c1">// master &amp; slave sockets</span>
	<span class="n">WSADATA</span> <span class="n">wsadata</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">service</span><span class="p">[]</span> <span class="o">=</span> <span class="s">"50500"</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="n">sin</span><span class="p">;</span>							   <span class="c1">// an Internet endpoint address</span>
	<span class="kt">int</span> <span class="n">alen</span><span class="p">;</span>										   <span class="c1">// from-address length</span>
	<span class="kt">char</span> <span class="n">pts</span><span class="p">[</span><span class="n">BUFLEN</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>							   <span class="c1">// pointer to time string</span>
	<span class="kt">time_t</span> <span class="n">now</span><span class="p">;</span>										   <span class="c1">// current time</span>
	<span class="n">WSAStartup</span><span class="p">(</span><span class="n">WSVERS</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">wsadata</span><span class="p">);</span>					   <span class="c1">// åŠ è½½winsock libraryï¼ŒWSVERSä¸ºè¯·æ±‚ç‰ˆæœ¬ï¼Œwsadataè¿”å›ç³»ç»Ÿå®é™…æ”¯æŒçš„æœ€é«˜ç‰ˆæœ¬</span>
	<span class="n">msock</span> <span class="o">=</span> <span class="n">socket</span><span class="p">(</span><span class="n">PF_INET</span><span class="p">,</span> <span class="n">SOCK_STREAM</span><span class="p">,</span> <span class="n">IPPROTO_TCP</span><span class="p">);</span> <span class="c1">// åˆ›å»ºå¥—æ¥å­—ã€‚ å‚æ•°ï¼šå› ç‰¹ç½‘åè®®ç°‡(family)ï¼Œå­—èŠ‚æµï¼ŒTCPåè®®å·ã€‚ è¿”å›ï¼šè¦ç›‘å¬å¥—æ¥å­—çš„æè¿°ç¬¦æˆ–INVALID_SOCKET</span>
	<span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sin</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">sin</span><span class="p">));</span>					   <span class="c1">//ä»&amp;sinå¼€å§‹çš„é•¿åº¦ä¸ºsizeof(sin)çš„å†…å­˜æ¸…0 , sinä¸ºä¸€ä¸ªåœ°å€ç»“æ„</span>
	<span class="n">sin</span><span class="p">.</span><span class="n">sin_family</span> <span class="o">=</span> <span class="n">AF_INET</span><span class="p">;</span>						   <span class="c1">//å› ç‰¹ç½‘åœ°å€ç°‡(INET-Internet)</span>
	<span class="n">sin</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">s_addr</span> <span class="o">=</span> <span class="n">INADDR_ANY</span><span class="p">;</span>				   <span class="c1">//ç›‘å¬æ‰€æœ‰(æ¥å£çš„)IPåœ°å€(32ä½)ï¼Œ// 0.0.0.0</span>
	<span class="n">sin</span><span class="p">.</span><span class="n">sin_port</span> <span class="o">=</span> <span class="n">htons</span><span class="p">((</span><span class="n">u_short</span><span class="p">)</span><span class="n">atoi</span><span class="p">(</span><span class="n">service</span><span class="p">));</span>	  <span class="c1">//ç›‘å¬çš„ç«¯å£å·(16ä½) ã€‚atoi--æŠŠasciiè½¬åŒ–ä¸ºintï¼Œhtonsâ€”ä¸»æœºåºåˆ°ç½‘ç»œåº</span>
	<span class="n">bind</span><span class="p">(</span><span class="n">msock</span><span class="p">,</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">sin</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">sin</span><span class="p">));</span> <span class="c1">// é€šè¿‡sinæŠŠè¦ç›‘å¬çš„IPåœ°å€å’Œç«¯å£å·ç»‘å®šåˆ°å¥—æ¥å­—ä¸Š</span>
	<span class="n">listen</span><span class="p">(</span><span class="n">msock</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>								   <span class="c1">// å»ºç«‹é•¿åº¦ä¸º5çš„è¿æ¥è¯·æ±‚é˜Ÿåˆ—ï¼Œå¹¶å¼€å§‹ç›‘å¬æ˜¯å¦æœ‰è¿æ¥è¯·æ±‚åˆ°æ¥ï¼Œæ¥äº†åˆ™æ”¾å…¥é˜Ÿåˆ—</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">"Server Start to listen.</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
	<span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">_kbhit</span><span class="p">())</span> <span class="c1">// æ£€æµ‹æ˜¯å¦æœ‰æŒ‰é”® (ä»€ä¹ˆæ—¶å€™æ‰§è¡Œï¼Ÿ)</span>
	<span class="p">{</span>
		<span class="n">alen</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr</span><span class="p">);</span>
		<span class="n">ssock</span> <span class="o">=</span> <span class="n">accept</span><span class="p">(</span><span class="n">msock</span><span class="p">,</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">fsin</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">alen</span><span class="p">);</span> <span class="c1">// acceptï¼šå¦‚æœæœ‰æ–°çš„è¿æ¥è¯·æ±‚ï¼Œè¿”å›è¿æ¥å¥—æ¥å­—ï¼Œå¦åˆ™ï¼Œè¢«é˜»å¡ï¼ŒfsinåŒ…å«å®¢æˆ·ç«¯IPåœ°å€å’Œç«¯å£å·</span>
		<span class="n">time</span><span class="p">(</span><span class="o">&amp;</span><span class="n">now</span><span class="p">);</span>												<span class="c1">// å–å¾—ç³»ç»Ÿæ—¶é—´</span>
		<span class="kt">int</span> <span class="n">cnt</span> <span class="o">=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="s">"Accept Time:</span><span class="se">\n</span><span class="s">"</span>
							   <span class="s">"%s"</span>
							   <span class="s">"sin_port:</span><span class="se">\n</span><span class="s">"</span>
							   <span class="s">"%u</span><span class="se">\n</span><span class="s">"</span>
							   <span class="s">"sin_addr:</span><span class="se">\n</span><span class="s">"</span>
							   <span class="s">"%d.%d.%d.%d</span><span class="se">\n</span><span class="s">"</span>
							   <span class="s">"Receive Message:</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span>
						  <span class="n">ctime</span><span class="p">(</span><span class="o">&amp;</span><span class="n">now</span><span class="p">),</span>
						  <span class="n">fsin</span><span class="p">.</span><span class="n">sin_port</span><span class="p">,</span>
						  <span class="n">fsin</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">S_un</span><span class="p">.</span><span class="n">S_un_b</span><span class="p">.</span><span class="n">s_b1</span><span class="p">,</span>
						  <span class="n">fsin</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">S_un</span><span class="p">.</span><span class="n">S_un_b</span><span class="p">.</span><span class="n">s_b2</span><span class="p">,</span>
						  <span class="n">fsin</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">S_un</span><span class="p">.</span><span class="n">S_un_b</span><span class="p">.</span><span class="n">s_b3</span><span class="p">,</span>
						  <span class="n">fsin</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">S_un</span><span class="p">.</span><span class="n">S_un_b</span><span class="p">.</span><span class="n">s_b4</span><span class="p">);</span> <span class="c1">// æŠŠæ—¶é—´è½¬æ¢ä¸ºå­—ç¬¦ä¸²</span>
		<span class="kt">int</span> <span class="n">cc</span> <span class="o">=</span> <span class="n">recv</span><span class="p">(</span><span class="n">ssock</span><span class="p">,</span> <span class="n">pts</span> <span class="o">+</span> <span class="n">cnt</span><span class="p">,</span> <span class="n">BUFLEN</span> <span class="o">-</span> <span class="n">cnt</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">pts</span><span class="p">[</span><span class="n">cnt</span> <span class="o">+</span> <span class="n">cc</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">pts</span><span class="p">);</span>
		<span class="n">send</span><span class="p">(</span><span class="n">ssock</span><span class="p">,</span> <span class="n">pts</span><span class="p">,</span> <span class="n">cnt</span> <span class="o">+</span> <span class="n">cc</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">closesocket</span><span class="p">(</span><span class="n">ssock</span><span class="p">);</span> <span class="c1">//  å…³é—­è¿æ¥å¥—æ¥å­—</span>
	<span class="p">}</span>
	<span class="n">closesocket</span><span class="p">(</span><span class="n">msock</span><span class="p">);</span>
	<span class="n">WSACleanup</span><span class="p">();</span>
	<span class="n">system</span><span class="p">(</span><span class="s">"pause"</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="å®¢æˆ·ç«¯çš„å…¨éƒ¨æºä»£ç æˆ–è‡ªé€‰ä¸»è¦ä»£ç ">å®¢æˆ·ç«¯çš„å…¨éƒ¨æºä»£ç ï¼ˆæˆ–è‡ªé€‰ä¸»è¦ä»£ç ï¼‰</h4>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
#include &lt;winsock2.h&gt;
#define BUFLEN 2000
#define WSVERS MAKEWORD(2, 0)
#pragma comment(lib, "ws2_32.lib")
</span><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
	<span class="kt">char</span> <span class="n">host</span><span class="p">[]</span> <span class="o">=</span> <span class="s">"127.0.0.1"</span><span class="p">;</span>			   <span class="c1">// server IP to connectï¼Œ127.0.0.1æŒ‡æœ¬æœº</span>
	<span class="kt">char</span> <span class="n">service</span><span class="p">[]</span> <span class="o">=</span> <span class="s">"50500"</span><span class="p">;</span>			   <span class="c1">// server port to connect</span>
	<span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="n">sin</span><span class="p">;</span>				   <span class="c1">// an Internet endpoint address</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="n">BUFLEN</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">msg</span><span class="p">[</span><span class="n">BUFLEN</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span> <span class="c1">// buffer for one line of text</span>
	<span class="n">SOCKET</span> <span class="n">sock</span><span class="p">;</span>						   <span class="c1">// socket descriptor</span>
	<span class="kt">int</span> <span class="n">cc</span><span class="p">;</span>								   <span class="c1">// recv character count</span>
	<span class="n">WSADATA</span> <span class="n">wsadata</span><span class="p">;</span>
	<span class="n">WSAStartup</span><span class="p">(</span><span class="n">WSVERS</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">wsadata</span><span class="p">);</span>
	<span class="n">sock</span> <span class="o">=</span> <span class="n">socket</span><span class="p">(</span><span class="n">PF_INET</span><span class="p">,</span> <span class="n">SOCK_STREAM</span><span class="p">,</span> <span class="n">IPPROTO_TCP</span><span class="p">);</span>
	<span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sin</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">sin</span><span class="p">));</span>				  <span class="c1">// sinçš„å†…å­˜æ¸…0</span>
	<span class="n">sin</span><span class="p">.</span><span class="n">sin_family</span> <span class="o">=</span> <span class="n">AF_INET</span><span class="p">;</span>					  <span class="c1">// å› ç‰¹ç½‘åœ°å€ç°‡</span>
	<span class="n">sin</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">s_addr</span> <span class="o">=</span> <span class="n">inet_addr</span><span class="p">(</span><span class="n">host</span><span class="p">);</span>		  <span class="c1">// æœåŠ¡å™¨IPåœ°å€(32ä½)</span>
	<span class="n">sin</span><span class="p">.</span><span class="n">sin_port</span> <span class="o">=</span> <span class="n">htons</span><span class="p">((</span><span class="n">u_short</span><span class="p">)</span><span class="n">atoi</span><span class="p">(</span><span class="n">service</span><span class="p">));</span> <span class="c1">// æœåŠ¡å™¨ç«¯å£å·(16ä½)</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">"Send the Message:</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
	<span class="n">gets</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">sin</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">sin</span><span class="p">));</span> <span class="c1">// è¿æ¥åˆ°æœåŠ¡å™¨.æ— é”™æ—¶ï¼Œè¿”å›0ï¼Œ // å¦åˆ™ï¼Œè¿”å›SOCKET_ERROR ï¼Œå¯ä»¥è°ƒç”¨ //    å‡½æ•°WSAGetLastErrorå–å¾—é”™è¯¯ä»£ç </span>
	<span class="n">cc</span> <span class="o">=</span> <span class="n">send</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">msg</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>						   <span class="c1">//æŠŠç¼“å†²åŒºptsçš„æ•°æ®å‘é€å‡ºå»ï¼Œlenä¸ºè¦å‘é€çš„å­—èŠ‚æ•°ï¼Œ // è¿”å›å€¼ï¼š(&gt;0) å®é™…å‘é€çš„å­—èŠ‚æ•°(â‰¤len), (=0) å¯¹æ–¹æ­£å¸¸å…³é—­ï¼Œ //    ï¼ˆ=SOCKET_ERROR) å‡ºé”™ï¼Œç”¨å‡½æ•°WSAGetLastErrorå–é”™è¯¯ç ã€‚</span>
	<span class="n">cc</span> <span class="o">=</span> <span class="n">recv</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">BUFLEN</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>							   <span class="c1">// BUFLENä¸ºç¼“å†²åŒºbufçš„é•¿åº¦ã€‚ // è¿”å›å€¼ï¼šæ¥æ”¶çš„å­—ç¬¦æ•°(&gt;0)ã€å¯¹æ–¹å·²å…³é—­(=0) æˆ–è¿æ¥å‡ºé”™(&lt;0)</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">cc</span> <span class="o">==</span> <span class="n">SOCKET_ERROR</span><span class="p">)</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">"Error:</span><span class="se">\n</span><span class="s">%d.</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">GetLastError</span><span class="p">());</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">cc</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">"Server closed.</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">cc</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">buf</span><span class="p">[</span><span class="n">cc</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'\0'</span><span class="p">;</span>		   <span class="c1">//  ensure null-termination</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span> <span class="c1">// æ˜¾ç¤ºæ‰€æ¥æ”¶çš„å­—ç¬¦ä¸²</span>
	<span class="p">}</span>
	<span class="n">closesocket</span><span class="p">(</span><span class="n">sock</span><span class="p">);</span> <span class="c1">// å…³é—­å¥—æ¥å­—</span>
	<span class="n">WSACleanup</span><span class="p">();</span>	  <span class="c1">//  å¸è½½winsock library</span>
	<span class="n">system</span><span class="p">(</span><span class="s">"pause"</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="ç¼–å†™udp-echoå¢å¼ºç¨‹åº">ç¼–å†™UDP Echoå¢å¼ºç¨‹åº</h3>

<h4 id="å®éªŒè¦æ±‚-1">å®éªŒè¦æ±‚</h4>

<p>ä¿®æ”¹UDPä¾‹ç¨‹ï¼Œå®ŒæˆEchoåŠŸèƒ½ï¼Œå³å½“å®¢æˆ·ç«¯å‘æ¥æ¶ˆæ¯æ—¶ï¼ŒæœåŠ¡å™¨æ˜¾ç¤ºå‡ºæœåŠ¡å™¨çš„å½“å‰æ—¶é—´ã€å®¢æˆ·ç«¯çš„IPã€å®¢æˆ·ç«¯çš„ç«¯å£å·å’Œå®¢æˆ·å‘æ¥çš„ä¿¡æ¯ï¼Œå¹¶æŠŠå®ƒä»¬ä¸€å¹¶å‘å›ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯ç„¶åæŠŠå®ƒä»¬æ˜¾ç¤ºå‡ºæ¥ã€‚
æœåŠ¡å™¨å¯ä»¥ç›´æ¥ä»recvfrom()çš„å‚æ•°fromä¸­å¾—åˆ°å®¢æˆ·ç«¯çš„IPåœ°å€å’Œç«¯å£å·ï¼Œå¹¶ä¸”æœåŠ¡å™¨ç”¨sendto()å‘å›ç»™å®¢æˆ·ç«¯æ¶ˆæ¯æ—¶å¯ä»¥ç›´æ¥ç”¨è¯¥å‚æ•°fromä½œä¸ºå‚æ•°toAddrã€‚å¯ä»¥ä½¿ç”¨inet_ntoa()è½¬æ¢å®¢æˆ·ç«¯IPåœ°å€ã€‚
å®¢æˆ·ç«¯ç¨‹åºçš„recvfrom()å¯ä»¥ç›´æ¥ä½¿ç”¨åŸæ¥sendtoä½¿ç”¨çš„sockã€‚è¯¥sockå·²ç»ç»‘å®šäº†å®¢æˆ·ç«¯çš„IPåœ°å€å’Œç«¯å£å·ï¼Œå®¢æˆ·ç«¯å¯ä»¥ç›´æ¥ç”¨æ¥æ¥æ”¶æ•°æ®ã€‚</p>

<h4 id="åªè¿è¡Œå®¢æˆ·ç«¯ç¨‹åºè€Œä¸è¿è¡ŒæœåŠ¡å™¨ç¨‹åºä¼šå‡ºç°ä»€ä¹ˆé”™è¯¯æˆªå±å¹¶è¯´æ˜åŸå› -1">åªè¿è¡Œå®¢æˆ·ç«¯ç¨‹åºè€Œä¸è¿è¡ŒæœåŠ¡å™¨ç¨‹åºä¼šå‡ºç°ä»€ä¹ˆé”™è¯¯ï¼Œæˆªå±å¹¶è¯´æ˜åŸå› </h4>

<p><img src="/public/image/2019-03-11-4.jpg" alt="å›¾ç‰‡æè¿°" />
å¦‚å›¾ï¼Œåœ¨å‘é€æ—¶æ²¡æœ‰æŠ¥é”™ï¼Œä½†æ˜¯è¯•å›¾ä»æœåŠ¡å™¨è·å¾—ä¿¡æ¯æ—¶è·å¾—äº†10054çš„æŠ¥é”™ã€‚</p>

<h4 id="æˆªå±æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„è¿è¡Œç»“æœæ³¨æ˜å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨">æˆªå±æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„è¿è¡Œç»“æœï¼ˆæ³¨æ˜å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ï¼‰</h4>

<p><img src="/public/image/2019-03-11-5.jpg" alt="å›¾ç‰‡æè¿°" />
æœåŠ¡å™¨ï¼š
<img src="/public/image/2019-03-11-6.jpg" alt="å›¾ç‰‡æè¿°" /></p>

<h4 id="æœåŠ¡å™¨çš„å…¨éƒ¨æºä»£ç æˆ–è‡ªé€‰ä¸»è¦ä»£ç -1">æœåŠ¡å™¨çš„å…¨éƒ¨æºä»£ç ï¼ˆæˆ–è‡ªé€‰ä¸»è¦ä»£ç ï¼‰</h4>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
#include &lt;time.h&gt;
#include &lt;conio.h&gt;
#include &lt;winsock2.h&gt;
#define BUFLEN 2000				   // ç¼“å†²åŒºå¤§å°
#define WSVERS MAKEWORD(2, 2)	  // æŒ‡æ˜ç‰ˆæœ¬2.2
#pragma comment(lib, "ws2_32.lib") // åŠ è½½winsock 2.2 Llibrary
</span><span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
	<span class="kt">char</span> <span class="n">host</span><span class="p">[]</span> <span class="o">=</span> <span class="s">"127.0.0.1"</span><span class="p">;</span> <span class="c1">// server IP Address to connect</span>
	<span class="kt">char</span> <span class="n">service</span><span class="p">[]</span> <span class="o">=</span> <span class="s">"50500"</span><span class="p">;</span>  <span class="c1">// server port to connect</span>
	<span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="n">sin</span><span class="p">;</span>	<span class="c1">// an Internet endpoint address</span>
	<span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="n">from</span><span class="p">;</span>   <span class="c1">// sender address</span>
	<span class="kt">int</span> <span class="n">fromsize</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">from</span><span class="p">);</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="n">BUFLEN</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="n">BUFLEN</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span> <span class="c1">// buffer for one line of text</span>
	<span class="n">SOCKET</span> <span class="n">sock</span><span class="p">;</span>						   <span class="c1">// socket descriptor</span>
	<span class="kt">int</span> <span class="n">cc</span><span class="p">;</span>								   <span class="c1">// recv character count</span>
	<span class="n">WSADATA</span> <span class="n">wsadata</span><span class="p">;</span>
	<span class="n">WSAStartup</span><span class="p">(</span><span class="n">WSVERS</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">wsadata</span><span class="p">);</span>					 <span class="c1">// åŠ è½½winsock libraryï¼ŒWSVERSä¸ºè¯·æ±‚ç‰ˆæœ¬,wsadataè¿”å›ç³»ç»Ÿå®é™…æ”¯æŒçš„æœ€é«˜ç‰ˆæœ¬ã€‚</span>
	<span class="n">sock</span> <span class="o">=</span> <span class="n">socket</span><span class="p">(</span><span class="n">PF_INET</span><span class="p">,</span> <span class="n">SOCK_DGRAM</span><span class="p">,</span> <span class="n">IPPROTO_UDP</span><span class="p">);</span> <span class="c1">// åˆ›å»ºUDPå¥—æ¥å­—, å‚æ•°ï¼šå› ç‰¹ç½‘åè®®ç°‡(family)ï¼Œæ•°æ®æŠ¥å¥—æ¥å­—ï¼ŒUDPåè®®å·ï¼Œ è¿”å›ï¼šè¦ç›‘å¬å¥—æ¥å­—çš„æè¿°ç¬¦æˆ–INVALID_SOCKET</span>
	<span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sin</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">sin</span><span class="p">));</span>
	<span class="n">sin</span><span class="p">.</span><span class="n">sin_family</span> <span class="o">=</span> <span class="n">AF_INET</span><span class="p">;</span>
	<span class="n">sin</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">s_addr</span> <span class="o">=</span> <span class="n">INADDR_ANY</span><span class="p">;</span>				  <span class="c1">// ç»‘å®š(ç›‘å¬)æ‰€æœ‰çš„æ¥å£ã€‚</span>
	<span class="n">sin</span><span class="p">.</span><span class="n">sin_port</span> <span class="o">=</span> <span class="n">htons</span><span class="p">((</span><span class="n">u_short</span><span class="p">)</span><span class="n">atoi</span><span class="p">(</span><span class="n">service</span><span class="p">));</span>	 <span class="c1">// ç»‘å®šæŒ‡å®šæ¥å£ã€‚atoi--æŠŠasciiè½¬åŒ–ä¸ºintï¼Œhtons -- ä¸»æœºåº(host)è½¬åŒ–ä¸ºç½‘ç»œåº(network), ä¸ºshortç±»å‹ã€‚</span>
	<span class="n">bind</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">sin</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">sin</span><span class="p">));</span> <span class="c1">// ç»‘å®šæœ¬åœ°ç«¯å£å·ï¼ˆå’Œæœ¬åœ°IPåœ°å€)</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">"UDPServer Start.</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
	<span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">_kbhit</span><span class="p">())</span>
	<span class="p">{</span>																	   <span class="c1">//æ£€æµ‹æ˜¯å¦æœ‰æŒ‰é”®</span>
		<span class="n">cc</span> <span class="o">=</span> <span class="n">recvfrom</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">BUFLEN</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">SOCKADDR</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">from</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fromsize</span><span class="p">);</span> <span class="c1">//æ¥æ”¶å®¢æˆ·æ•°æ®ã€‚è¿”å›ç»“æœï¼šccä¸ºæ¥æ”¶çš„å­—ç¬¦æ•°ï¼Œfromä¸­å°†åŒ…å«å®¢æˆ·IPåœ°å€å’Œç«¯å£å·ã€‚</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">cc</span> <span class="o">==</span> <span class="n">SOCKET_ERROR</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">printf</span><span class="p">(</span><span class="s">"recvfrom() failed; %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">WSAGetLastError</span><span class="p">());</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">cc</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">else</span>
		<span class="p">{</span>
			<span class="n">buf</span><span class="p">[</span><span class="n">cc</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="kt">time_t</span> <span class="n">now</span><span class="p">;</span>
			<span class="n">time</span><span class="p">(</span><span class="o">&amp;</span><span class="n">now</span><span class="p">);</span> <span class="c1">// å–å¾—ç³»ç»Ÿæ—¶é—´</span>
			<span class="n">sprintf</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span>
					<span class="s">"Accept Time:</span><span class="se">\n</span><span class="s">"</span>
					<span class="s">"%s"</span>
					<span class="s">"sin_port:</span><span class="se">\n</span><span class="s">"</span>
					<span class="s">"%u</span><span class="se">\n</span><span class="s">"</span>
					<span class="s">"sin_addr:</span><span class="se">\n</span><span class="s">"</span>
					<span class="s">"%d.%d.%d.%d</span><span class="se">\n</span><span class="s">"</span>
					<span class="s">"Receive Message:</span><span class="se">\n</span><span class="s">"</span>
					<span class="s">"%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span>
					<span class="n">ctime</span><span class="p">(</span><span class="o">&amp;</span><span class="n">now</span><span class="p">),</span>
					<span class="n">from</span><span class="p">.</span><span class="n">sin_port</span><span class="p">,</span>
					<span class="n">from</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">S_un</span><span class="p">.</span><span class="n">S_un_b</span><span class="p">.</span><span class="n">s_b1</span><span class="p">,</span>
					<span class="n">from</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">S_un</span><span class="p">.</span><span class="n">S_un_b</span><span class="p">.</span><span class="n">s_b2</span><span class="p">,</span>
					<span class="n">from</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">S_un</span><span class="p">.</span><span class="n">S_un_b</span><span class="p">.</span><span class="n">s_b3</span><span class="p">,</span>
					<span class="n">from</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">S_un</span><span class="p">.</span><span class="n">S_un_b</span><span class="p">.</span><span class="n">s_b4</span><span class="p">,</span>
					<span class="n">buf</span><span class="p">);</span>
			<span class="n">printf</span><span class="p">(</span><span class="s">"%s"</span><span class="p">,</span> <span class="n">pts</span><span class="p">);</span>
			<span class="n">cc</span> <span class="o">=</span> <span class="n">sendto</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">pts</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">pts</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">SOCKADDR</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">from</span><span class="p">,</span> <span class="n">fromsize</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">closesocket</span><span class="p">(</span><span class="n">sock</span><span class="p">);</span>
	<span class="n">WSACleanup</span><span class="p">();</span> <span class="c1">// å¸è½½æŸç‰ˆæœ¬çš„DLL</span>
	<span class="n">system</span><span class="p">(</span><span class="s">"pause"</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="å®¢æˆ·ç«¯çš„å…¨éƒ¨æºä»£ç æˆ–è‡ªé€‰ä¸»è¦ä»£ç -1">å®¢æˆ·ç«¯çš„å…¨éƒ¨æºä»£ç ï¼ˆæˆ–è‡ªé€‰ä¸»è¦ä»£ç ï¼‰</h4>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
#include &lt;winsock2.h&gt;
#define BUFLEN 2000				   // ç¼“å†²åŒºå¤§å°
#define WSVERS MAKEWORD(2, 2)	  // æŒ‡æ˜ç‰ˆæœ¬2.2
#pragma comment(lib, "ws2_32.lib") // åŠ è½½winsock 2.2 Llibrary
</span><span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
	<span class="kt">char</span> <span class="n">host</span><span class="p">[]</span> <span class="o">=</span> <span class="s">"127.0.0.1"</span><span class="p">;</span>		 <span class="c1">// server IP to connect</span>
	<span class="kt">char</span> <span class="n">service</span><span class="p">[]</span> <span class="o">=</span> <span class="s">"50500"</span><span class="p">;</span>		 <span class="c1">// server port to connect</span>
	<span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="n">toAddr</span><span class="p">,</span> <span class="n">from</span><span class="p">;</span> <span class="c1">// an Internet endpoint address</span>
	<span class="kt">int</span> <span class="n">fromsize</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">from</span><span class="p">);</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="n">BUFLEN</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span> <span class="c1">// buffer for one line of text</span>
	<span class="n">SOCKET</span> <span class="n">sock</span><span class="p">;</span>		  <span class="c1">// socket descriptor</span>
	<span class="kt">int</span> <span class="n">cc</span><span class="p">;</span>				  <span class="c1">// recv character count</span>
	<span class="n">WSADATA</span> <span class="n">wsadata</span><span class="p">;</span>
	<span class="n">WSAStartup</span><span class="p">(</span><span class="n">WSVERS</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">wsadata</span><span class="p">);</span> <span class="c1">// å¯åŠ¨æŸç‰ˆæœ¬Socketçš„DLL</span>
	<span class="n">sock</span> <span class="o">=</span> <span class="n">socket</span><span class="p">(</span><span class="n">PF_INET</span><span class="p">,</span> <span class="n">SOCK_DGRAM</span><span class="p">,</span> <span class="n">IPPROTO_UDP</span><span class="p">);</span>
	<span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">toAddr</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">toAddr</span><span class="p">));</span>
	<span class="n">toAddr</span><span class="p">.</span><span class="n">sin_family</span> <span class="o">=</span> <span class="n">AF_INET</span><span class="p">;</span>
	<span class="n">toAddr</span><span class="p">.</span><span class="n">sin_port</span> <span class="o">=</span> <span class="n">htons</span><span class="p">((</span><span class="n">u_short</span><span class="p">)</span><span class="n">atoi</span><span class="p">(</span><span class="n">service</span><span class="p">));</span> <span class="c1">//atoiï¼šæŠŠasciiè½¬åŒ–ä¸ºint. htonsï¼šä¸»æœºåº(host)è½¬åŒ–ä¸ºç½‘ç»œåº(network), s--short</span>
	<span class="n">toAddr</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">s_addr</span> <span class="o">=</span> <span class="n">inet_addr</span><span class="p">(</span><span class="n">host</span><span class="p">);</span>		 <span class="c1">//å¦‚æœhostä¸ºåŸŸåï¼Œéœ€è¦å…ˆç”¨å‡½æ•°gethostbynameæŠŠåŸŸåè½¬åŒ–ä¸ºIPåœ°å€</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">"Send the Message:</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
	<span class="n">gets</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
	<span class="n">cc</span> <span class="o">=</span> <span class="n">sendto</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">SOCKADDR</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">toAddr</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">toAddr</span><span class="p">));</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">cc</span> <span class="o">==</span> <span class="n">SOCKET_ERROR</span><span class="p">)</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">"Error:</span><span class="se">\n</span><span class="s">%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">WSAGetLastError</span><span class="p">());</span>
	<span class="k">else</span>
	<span class="p">{</span>
		<span class="n">cc</span> <span class="o">=</span> <span class="n">recvfrom</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">BUFLEN</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">SOCKADDR</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">from</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fromsize</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">cc</span> <span class="o">==</span> <span class="n">SOCKET_ERROR</span><span class="p">)</span>
			<span class="n">printf</span><span class="p">(</span><span class="s">"Receive Error:</span><span class="se">\n</span><span class="s">%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">WSAGetLastError</span><span class="p">());</span>
		<span class="k">else</span>
			<span class="n">printf</span><span class="p">(</span><span class="s">"%s"</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">closesocket</span><span class="p">(</span><span class="n">sock</span><span class="p">);</span>
	<span class="n">WSACleanup</span><span class="p">();</span> <span class="c1">// å¸è½½æŸç‰ˆæœ¬çš„DLL</span>
	<span class="n">system</span><span class="p">(</span><span class="s">"pause"</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="å®éªŒä½“ä¼š">å®éªŒä½“ä¼š</h2>

<p>åœ¨Windowsä¸‹ä½¿ç”¨gccç¼–è¯‘ï¼Œéœ€è¦åŠ ç¼–è¯‘æŒ‡ä»¤-lwsock32æ¥å¼•å…¥å¥—æ¥å­—çš„åº“ï¼Œäºæ˜¯å†™äº†å¦‚ä¸‹è„šæœ¬å¸®åŠ©ç¼–è¯‘ï¼š</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gcc TCPServer.c <span class="nt">-o</span> TCPServer <span class="nt">-lwsock32</span>
gcc TCPClient.c <span class="nt">-o</span> TCPClient <span class="nt">-lwsock32</span>
</code></pre></div></div>

<p>èŠ‚çœäº†ä¸å°‘æ—¶é—´ã€‚</p>

<p>æœåŠ¡å™¨å¯¹æ”¶åˆ°çš„æ¶ˆæ¯è¿›è¡Œå¤„ç†è¿™é‡Œä½¿ç”¨äº†sprintfè¿™ä¸ªå‡½æ•°ï¼Œæ„Ÿè§‰ç›¸æ¯”åˆ«çš„æ–¹æ³•ç®€åŒ–äº†å¾ˆå¤šä»£ç ã€‚</p>

<p>æƒ³å½“ç„¶çš„è®¤ä¸ºæœåŠ¡å™¨ç¨‹åºåªéœ€è¦æŒ‰ä¸‹é”®ç›˜å°±ä¼šé€€å‡ºï¼Œè¯´æ˜ä¸€å¼€å§‹å¯¹é˜»å¡çš„ç†è§£è¿˜ä¸é€å½»å•Šã€‚</p>
:ET